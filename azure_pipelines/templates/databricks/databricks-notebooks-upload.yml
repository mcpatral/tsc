parameters:
- name: notebookLanguage
  displayName: Notebook language (e.g. python)
  type: string

- name:  notebookLocalPath
  displayName: Notebook local path
  type: string

- name: databricksRemotePath
  displayName: Databricks Remote path to upload notebook
  type: string

- name: condition
  displayName: Run conditions for task
  type: string
  default: ""

steps:
- task: Bash@3
  ${{ if ne(parameters.condition, '') }}:
    condition: ${{ parameters.condition }}
  displayName: 'Uploading notebooks'
  inputs:
    targetType: 'inline'
    script: |
      echo "List files to upload"
      echo "=============================================================================="
      ls -ls  ${{ parameters.notebookLocalPath }}
      echo "=============================================================================="
      echo "Uploading notebooks ... "
      echo "=============================================================================="
      for file in $local_path
      do
        if [ -f "$file" ]; then
          basename=${file##*/}
          echo "Uploading: $basename"
          command_output=$(databricks workspace import --language $notebook_language --overwrite --file "$file" "$remote_path/${basename%.*}")
          echo "$command_output"
          # ------------ TODO: review errors ------------
          if [[ $command_output == *"Error"* ]]; then
            exit 1
          fi
        fi
      done
  env:
    notebook_language: ${{ parameters.notebookLanguage }}
    local_path: ${{ parameters.notebookLocalPath }}
    remote_path: ${{ parameters.databricksRemotePath }}
    #ANOTHER OPTION, UPLOADING EVERYTHING IN THE FOLDER databricks workspace import_dir --overwrite ./notebooks/*.py /Shared
