parameters:
- name: databricksClusterName
  displayName: Databricks cluster ID
  type: string

- name: condition
  displayName: Run conditions for task
  type: string
  default: ""

steps:
  - task: Bash@3
    displayName: 'Get Databricks cluster id'
    ${{ if ne(parameters.condition, '') }}:
      condition: ${{ parameters.condition }}
    inputs:
      targetType: 'inline'
      script: |
        echo "Cluster name: ${{ parameters.databricksClusterName }}"
        databricksClusterId=$(databricks clusters get --cluster-name ${{ parameters.databricksClusterName }} | jq -r .cluster_id)
        if [[ -n "$databricksClusterId" ]]
        then
          echo "Cluster Id: $databricksClusterId"
          echo "##vso[task.setvariable variable=databricksClusterId]$databricksClusterId"
        else
            echo "Databricks cluster id is empty, aborting."
            echo "Please check if cluster name is correct..."
            exit 1
        fi
