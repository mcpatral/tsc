parameters:
- name: azureServiceConnectionName
  displayName: Azure Service Connection name
  type: string
- name: saName
  displayName: Key Vault Name to store the keys.
  type: string
- name: resourceGroupName
  displayName: Resource Group Name where the storage accounts are.
  type: string
- name: keyVaultName
  displayName: Key Vault Name to store the keys.
  type: string
- name: keyVaultSecretName
  displayName: Key Vault Secret Name to store the keys.
  type: string

steps:
- template: azcli/sa-keys-renew.yml
  parameters:
    saName: ${{ parameters.saName }}
    resourceGroupName: ${{ parameters.resourceGroupName }}
    workingDirectory: $(System.DefaultWorkingDirectory)
    azureServiceConnectionName: ${{ parameters.azureServiceConnectionName }}
- template: azcli/kv-create-secrets.yml
  parameters:
    keyVaultName: ${{ parameters.keyVaultName }}
    keyVaultSecretName: ${{ parameters.keyVaultSecretName }}
    keyVaultSecretValue: "$(saKey1)"
    workingDirectory: $(System.DefaultWorkingDirectory)
    azureServiceConnectionName: ${{ parameters.azureServiceConnectionName }}