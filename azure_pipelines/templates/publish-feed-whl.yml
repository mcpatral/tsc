parameters:
  - name: feedServiceConnectionName
    type: string

  - name: projectName
    type: string

  - name: feedName
    type: string

  - name: artifactsDirectory
    type: string

  - name: packageType
    type: string

steps:
  - task: DownloadBuildArtifacts@1
    displayName: 'Download Build Artifacts'
    inputs:
      buildType: 'current'
      artifactName: '${{ parameters.artifactsDirectory }}'

  - template: python/pip-get-version.yml

  - template: python/pip-install-package.yml
    parameters:
      commandArgs: '--upgrade twine'

  - task: TwineAuthenticate@1
    inputs:
      artifactFeed: ${{ parameters.projectName }}/${{ parameters.feedName }}
      pythonUploadServiceConnection: ${{ parameters.feedServiceConnectionName}}
    displayName: "Authentication to ${{ parameters.feedName }} feed"

  - script: |
      python3 -m twine upload -r ${{ parameters.feedName }} --config-file $(PYPIRC_PATH) $(System.ArtifactsDirectory)/${{ parameters.artifactsDirectory}}/*.${{ parameters.packageType}}
    displayName: "Uploading artifacts ${{ parameters.feedName }} to feed"